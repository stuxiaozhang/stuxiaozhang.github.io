<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/mytheme/favicon.png"><link rel="icon" href="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/mytheme/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="这篇文章整理了有关数据库的 Data Query Language 数据查询语言的相关操作，包括：SELECT，WHERE，ORDER BY，GROUP BY 和 HAVING 等等。
"><meta name="author" content="小张同学"><meta name="keywords" content=""><title>SQL的数据查询语言DQL - 小张同学的博客</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"stuxiaozhang.github.io",root:"/",version:"1.8.11",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:4},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"81O1jSOqY3veRxOg71BDYfri-gzGzoHsz",app_key:"CgnvRL262D07ied40NiXm2VL",server_url:null}},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><header style="height:50vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>xiaozhang's space</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/schedule/"><i class="iconfont icon-cliplist"></i> 动态</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://gitee.com/stuxiaozhang/blogimage/raw/master/img/mytheme/post.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="SQL的数据查询语言DQL"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> 小张同学 </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-02-06 06:04" pubdate>2021年2月6日</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 31 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-1"></div><div class="col-lg-9 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">SQL的数据查询语言DQL</h1><p class="note note-info">本文最后更新于：2021年2月9日</p><div class="markdown-body"><p>这篇文章整理了有关数据库的 Data Query Language 数据查询语言的相关操作，包括：SELECT，WHERE，ORDER BY，GROUP BY 和 HAVING 等等。</p><p><em><a id="more"></a></em></p><hr><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210208073436724.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:100%"></center><h1 id="dql数据查询语言">DQL：数据查询语言</h1><h2 id="普通查询">普通查询</h2><h3 id="记录查询-select-from">记录查询 SELECT FROM</h3><p>最基本的查询语句是由 SELECT 和 FROM 关键字组成的。</p><blockquote><p>SELECT 语句屏蔽了物理层的操作，用户不必关心数据的真实存储，交由数据库高效的查找数据</p></blockquote><p>栗：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM t_emp;<br>SELECT id, nme FROM t_student;<br></code></pre></td></tr></table></figure><h3 id="使用列别名-as">使用列别名 AS</h3><p>通常情况下， SELECT 子句中使用了表达式，那么这列的名字就默认为表达式，因此需要一种对列名重命名的机制 AS 。</p><blockquote><p>重命名只在显示输出的时候使用，数据表列名不会真的改变</p></blockquote><p>栗：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>  ename,<br>  sal*12 AS &quot;annual_salary&quot;<br>FROM <br>  t_emp;<br></code></pre></td></tr></table></figure><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210207003518847.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:50%"></center><h3 id="数据分页-limit">数据分页 LIMIT</h3><p>LIMIT 关键字限定结果集数量。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT ... FROM ... LIMIT 起始位置, 偏移量;  # 注意是偏移量，而不是结束位置<br></code></pre></td></tr></table></figure><p>如果只有一个参数，他表示表示的是偏移量，起始值默认为0。</p><h3 id="排序-order-by">排序 ORDER BY</h3><p>如果想让结果集按照某种顺序排列，就必须使用 ORDER BY 子句。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT …… FROM …… ORDER BY 列名 [ ASC | DESC ];<br></code></pre></td></tr></table></figure><h4 id="排序关键字">排序关键字</h4><p>ASC 代表升序（默认）， DESC 代表降序</p><ul><li><p>如果排序列是数字类型，数据库就按照数字大小排序；如果是日期类型就按照日期大小排序，如果是字符串就按照字符集序号排序。</p></li><li><p>可以使用 ORDER BY 规定首要排序条件和次要排序条件。放前面的先排序。</p></li></ul><blockquote><p>注：ORDER BY 子句书写的时候放在 LIMIT 子句的前面 执行顺序：FROM--&gt; SELECT --&gt; ORDER BY --&gt; LIMIT</p></blockquote><h3 id="去重-distinct">去重 DISTINCT</h3><p>如果需要去除重复的数据，可以使用 DISTINCT 关键字来实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT 字段 FROM …… ;<br></code></pre></td></tr></table></figure><blockquote><p>注意：</p><ol type="1"><li><p>使用 DISTINCT 的 SELECT 子句中只能查询一列数据，如果查询多列，去除重复记录就会失效。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT job, ename FROM t_emp;  # 不可以查询多列<br></code></pre></td></tr></table></figure></li><li><p>DISTINCT 关键字只能在 SELECT 子句中使用一次</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT job, DISTINCT ename FROM t_emp;  # 错<br>SELECT job, DISTINCT ename FROM t_emp;  # 错<br></code></pre></td></tr></table></figure></li></ol></blockquote><h3 id="条件查询-where">条件查询 WHERE</h3><p>如需有条件地从表中选取数据，可将 WHERE 子句添加到 SELECT 语句中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT …… FROM …… WHERE 条件 [ AND OR ] 条件 ……;<br></code></pre></td></tr></table></figure><ul><li><p>WHERE 语句中的条件运算会用 到以下 四种运算符：</p><table><colgroup><col style="width:14%"><col style="width:85%"></colgroup><thead><tr class="header"><th>运算符</th><th>栗子</th></tr></thead><tbody><tr class="odd"><td>数学运算符</td><td><code>+, -, *, /, %</code></td></tr><tr class="even"><td>比较运算符</td><td><code>&gt;, &gt;=, &lt;, &lt;=, =, !=, IN</code>； <code>IS NULL, IS NOY NULL, BETWEEN AND, LIKE, REGEXP</code></td></tr><tr class="odd"><td>逻辑运算符</td><td><code>AND, OR, NOT, XOR(异或：相同为0，不同为1)</code></td></tr><tr class="even"><td>按位运算符</td><td><code>&amp;, |, ~(位取反), ^(位异或), &lt;&lt;(左移), &gt;&gt;(右移)</code></td></tr></tbody></table></li></ul><blockquote><p>注：WHERE 子句中，条件执行的顺序是从左到右的。所以我们应该把<strong>索引条件</strong>，或者<strong>筛选掉记录最多的条件</strong>写在最左侧。</p></blockquote><blockquote><p>条件查询中， WHERE 子句应该是第几个执行？ 执行顺序：FROM--&gt; WHERE --&gt; SELECT --&gt; ORDER BY --&gt; LIMIT</p><p>(WHERE 排在 SELECT 前是因为 WHERE先筛选符合条件的记录，SELECT 才能从中挑出结果集中显示的字段)</p></blockquote><p>栗子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT empno, ename, sal, hiredate<br>FROM t_emp<br>WHERE deptno&#x3D;10 AND (sal+IFNULL(comm, 0))*12&gt;&#x3D;15000 # IFNULL(expr1,expr2) 判断expr1是否NULL，是就expr2<br>AND DATEDIFF(NOW(),hiredate)&#x2F;365 &gt;&#x3D; 20;  # DATEDIFF(expr1,expr2)算两个日期的天数<br>IFNULL(expr1,expr2)<br></code></pre></td></tr></table></figure><h2 id="高级查询">高级查询</h2><h3 id="聚合函数">聚合函数</h3><p>聚合函数在数据的查询分析中，应用十分广泛。聚合函数可以对数据求和、求最大值和最小值、求平均值等等。</p><ul><li><p><strong>SUM 函数</strong>用于求和，<u>只能用于数字类型</u>，字符类型的统计结果为0 ，日期类型统计结果是毫秒数相加。</p></li><li><p><strong>MAX 函数</strong>用于获得非空值的最大值。</p></li><li><p><strong>MIN 函数</strong>用于获得非空值的最小值。</p></li><li><p><strong>AVG 函数</strong>用于获得非空值的平均值，非数字数据统计结果为0。</p></li><li><p>**COUNT(*)** 用于获得所有的(包含空值)的记录数</p><p><strong>COUNT(列名)</strong> 用于获得所有的(不包含空值)的记录数。</p></li></ul><p>栗子：查询10和20部门中，底薪超过2000元并且工龄超过15年的员工人数？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT COUNT(ename)<br>FROM t_emp<br>WHERE deptno IN(10, 20) AND sal&gt;&#x3D;2000 <br>AND DATEDIFF(NOW(), hiredate)&#x2F;365 &gt;&#x3D; 15;<br></code></pre></td></tr></table></figure><h3 id="分组查询-group-by">分组查询 GROUP BY</h3><p>默认情况下汇总函数是对全表范围内的数据做统计。</p><p>GROUP BY 子句的作用是通过一定的规则将一个数据集划分成若干个小的区域，然后针对每个小区域分别进行数据汇总处理。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT ... FROM ...<br>GROUP BY ...;<br></code></pre></td></tr></table></figure><ul><li><p>数据库支持多列分组条件，执行的时候逐级分组。</p><p>栗：查询每个部门里，每种职位的人员数量和平均底薪</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT deptno, job, COUNT(*), ROUND(AVG(sal))<br>FROM t_emp<br>GROUP BY deptno, job<br>ORDER BY deptno;<br></code></pre></td></tr></table></figure><p>注意：查询语句中如果含有 GROUP BY 子句，那么 SELECT 子句中的内容就必须要遵守规定：<strong>SELECT 子句中可以包括聚合函数，或者 GROUP BY 子句的分组列，其余内容均不可以出现在 SELECT 子句中</strong></p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs MYSQL">SELECT deptno, COUNT(*), AVG(sal)  # correct<br>FROM t_emp GROUP BY deptno;<br><br>SELECT deptno, COUNT(*), AVG(sal), sal  # wrong<br>FROM t_emp GROUP BY deptno;<br></code></pre></td></tr></table></figure><h4 id="with-rollup">WITH ROLLUP</h4><p>对分组结果集再次做汇总计算 WITH ROLLUP</p><p>栗：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT deptno, COUNT(*), AVG(sal), MAX(sal), MIN(sal)<br>FROM t_emp<br>GROUP BY deptno WITH ROLLUP;<br></code></pre></td></tr></table></figure><h4 id="group_concat-函数">GROUP_CONCAT 函数</h4><p>GROUP_CONCAT 函数可以把分组查询中的某个字段拼接成一个字符串。</p><p>栗：查询每个部门内底薪超过2000元的人数和员工姓名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT deptno, COUNT(*), GROUP_CONCAT(ename)<br>FROM t_emp<br>WHERE sal &gt;&#x3D; 2000<br>GROUP BY deptno;<br></code></pre></td></tr></table></figure><blockquote><p>查询语句中，GROUP BY子句应该第几个执行？</p><p>执行顺序：FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p></blockquote><h3 id="having-子句">HAVING 子句</h3><p>栗：查询部门平均底薪超过2000元的部门编号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT deptno FROM t_emp  # WRONG<br>WHERE AVG(sal) &gt;&#x3D; 2000<br>GROUP BY deptno;<br></code></pre></td></tr></table></figure><p><strong>因为 WHERE 子句先于 GROUP BY 执行，一旦 WHERE 子句中出现了聚合函数，数据库根本不知道按照什么范围计算汇总值。</strong></p><p>所以：</p><ul><li><p>WHERE 子句的作用是对查询结果进行分组前，将不符合 WHERE 条件的行去掉，即<strong>在分组之前过滤数据，WHERE 条件中不能包含聚组函数</strong>，使用 WHERE 条件过滤出特定的行。</p></li><li><p>HAVING 子句的作用是筛选满足条件的组，即<strong>在分组之后过滤数据</strong>，<strong>条件中经常包含聚组函数</strong>，使用 HAVING 条件过滤出特定的组，也可以使用多个分组标准进行分组。</p></li></ul><p>栗：查询每个部门中，1982年以后入职的员工超过2个人的部门编号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT deptno FROM t_emp<br>WHERE hiredate &gt;&#x3D; &quot;1982-01-01&quot;<br>GROUP BY deptno HAVING COUNT(*) &gt;&#x3D; 2<br>ORDER BY deptno ASC;<br></code></pre></td></tr></table></figure><blockquote><p>HAVING子句的特殊用法</p><p>按照数字1分组，MySQL 会依据 SELECT 子句中的列进行分组， HAVING 子句也可以正常使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT deptno, COUNT(*) FROM t_emp<br>GROUP BY 1;  # 1 相当于 deptno <br></code></pre></td></tr></table></figure></blockquote><h2 id="表连接查询">表连接查询</h2><p><strong>连接方式：</strong></p><ul><li>外连接：左连接，右连接，全外连接</li><li>内连接：等值连接，非等值连接，自然连接</li><li>交叉连接：笛卡尔积</li></ul><blockquote><p><strong>自然连接与等值连接的异同？</strong></p><ul><li><p>自然连接和等值连接的相同之处是<strong>二者都是根据属性值相等进行连接。</strong></p><blockquote><p>只返回两个表中连接字段相等的行</p></blockquote></li><li><p>二者的不同之处是：<strong>自然连接中相等的分量必须是相同的属性组，并且要在结果中去掉重复的属性。而等值连接不必。</strong></p></li></ul></blockquote><p><strong>连接方式说明：</strong></p><ul><li>内连接：只有两个元素表相匹配的才能在结果集中显示。只保留符合连接条件的记录</li><li>外连接：不管符不符合连接条件，记录都要保留在结果集中<ul><li>左外连接：左边表的数据全部显示，右边表的数据只显示共有的数据部分，不匹配的不会显示。</li><li>右外连接：右边表的数据全部显示，左边表的数据只显示共有的数据部分，不匹配的不会显示。</li><li>全外连接：连接的表中不匹配的数据全部会显示出来。</li></ul></li><li>交叉连接： 笛卡尔积，显示的结果是链接表数的乘积。</li></ul><h3 id="内连接">内连接</h3><p>内连接：只有两个元素表相匹配的才能在结果集中显示。只保留符合连接条件的记录</p><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210208222855455.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:50%"></center><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT …… FROM 表1 <br>[INNER] JOIN 表2 WHERE 连接条件 ;<br></code></pre></td></tr></table></figure><ul><li><strong>内连接的数据表不一定必须有同名字段，只要字段之间符合逻辑关系就可以</strong></li><li><strong>相同数据表也可以做表连接。</strong></li><li><strong>可以把查询的结果集当作一张表进行连接。</strong></li></ul><p>练习：</p><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210208231842179.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:55%"></center><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210208231932372.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:55%"></center><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210209154049652.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:100%"></center><p>练习：</p><ol type="1"><li><p>查询每个员工的工号、姓名、部门名称、底薪、职位、工资等级？</p><blockquote><p>sal 两个表没有同名的字段，但是<strong>内连接的数据表不一定必须有同名字段，只要字段之间符合逻辑关系就可以</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename, d.dname, e.job, s.grade <br>FROM t_emp e JOIN t_dept d ON e.deptno&#x3D;d.deptno<br>JOIN t_salgrade s ON e.sal BETWEEN s.losal AND s.hisal<br></code></pre></td></tr></table></figure></li><li><p>查询与SCOTT相同部门的员工都有谁？</p><p><strong>相同数据表也可以做表连接。</strong></p><p>写子查询语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT ename<br>FROM t_emp <br>WHERE deptno&#x3D;(SELECT deptno FROM t_dept WHERE ename&#x3D;&quot;SCOTT&quot;)<br>AND ename!&#x3D;&quot;SCOTT&quot;<br></code></pre></td></tr></table></figure><p>改成内连接：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e2.ename<br>FROM t_emp e1 JOIN t_emp e2 ON e1.deptno&#x3D;e2.deptno<br>WHERE e1.ename&#x3D;&quot;SCOTT&quot; AND e2.ename!&#x3D;&quot;SCOTT&quot;;<br></code></pre></td></tr></table></figure></li><li><p>查询月薪超过公司平均月薪的员工信息？</p><p><strong>可以把查询的结果集当作一张表进行连接。</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename, e.sal<br>FROM t_emp e <br>JOIN (SELECT AVG(sal) avg FROM t_emp) t;<br>ON e.sal&gt;&#x3D;t.avg;<br></code></pre></td></tr></table></figure></li><li><p>查询RESEARCH部门的人数、最高底薪、最低底薪、平均底薪、平均工龄？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT COUNT(*), MAX(e.sal), MIN(e.sal), FLOOR(AVG(DATEDIFF(NOW(), e.hiredate)&#x2F;365))<br>FROM t_emp e JOIN t_dept d<br>ON e.deptno&#x3D;d.deptno<br>WHERE d.dname&#x3D;&quot;RESEARCH&quot;;<br></code></pre></td></tr></table></figure></li><li><p>查询每种职业的最高工资、最低工资、平均工资、最高工资等级和 最低工资等级？</p><blockquote><p>工资：<code>e.sal + ISFULL(e.comm, 0)</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.job, <br>MAX(e.sal+IFNULL(e.comm, 0)), <br>MIN(e.sal+IFNULL(e.comm, 0)),<br>AVG(e.sal+IFNULL(e.comm, 0)),<br>MAX(s.grade), <br>MIN(s.grade)<br>FROM t_emp e JOIN t_salgrade s<br>ON (e.sal+IFNULL(e.comm, 0)) BETWEEN s.losal AND s.hisal<br>GROUP BY e.job;<br></code></pre></td></tr></table></figure></li><li><p>查询每个<u>底薪</u>超过<u>部门</u> <u>平均底薪</u>的员工信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT<br>	e.empno,<br>	e.ename,<br>	e.sal <br>FROM<br>	t_emp e<br>	JOIN ( SELECT deptno, AVG( SAL ) AS avg FROM t_emp GROUP BY deptno ) t ON e.deptno &#x3D; t.deptno <br>	AND e.sal &gt;&#x3D; t.avg;<br></code></pre></td></tr></table></figure></li></ol><h3 id="外连接">外连接</h3><p>外连接：不管符不符合连接条件，记录都要保留在结果集中</p><p>外连接包括：左(外)连接，右(外)连接，全外连接</p><ul><li>左外连接：左边表的数据全部显示，右边表的数据只显示共有的数据部分，不匹配的不会显示。</li><li>右外连接：右边表的数据全部显示，左边表的数据只显示共有的数据部分，不匹配的不会显示。</li><li>全外连接：连接的表中不匹配的数据全部会显示出来。</li></ul><p>注意：<strong>UNION关键字可以将多个查询语句的结果集进行合并</strong></p><p>栗子：列出员工的工号，姓名和部门名称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename, d.dname<br>FROM t_emp e JOIN t_dept d<br>ON e.deptno&#x3D;d.deptno;<br></code></pre></td></tr></table></figure><blockquote><p>如果使用内连接，有空值的员工就显示不出来。</p></blockquote><p>所以得改成左连接，如果有空值，就出NULL值来匹配。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename, d.dname<br>FROM t_emp e LEFT JOIN t_dept d<br>ON e.deptno&#x3D;d.deptno;<br></code></pre></td></tr></table></figure><p>或者由右外连接反着写也行。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename, d.dname<br>FROM t_dept d RIGHT JOIN t_emp e<br>ON e.deptno&#x3D;d.deptno;<br></code></pre></td></tr></table></figure><p>练习：</p><ol type="1"><li>查询每个部门的名称和部门的人数？</li></ol><blockquote><p>deptno=40的部门，有这个部门，没有员工。但是这个部门是存在的，所以要以部门：0的形式存在。</p></blockquote><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT d.deptno, d.dname, COUNT(e.deptno)<br>FROM t_dept d<br>LEFT JOIN t_emp e <br>ON d.deptno&#x3D;e.deptno<br>GROUP BY d.deptno;<br></code></pre></td></tr></table></figure>注意：不能再写 <code>COUNT(*)</code>，这样会把NULL值也算成一。所以要改成 <code>e.deptno</code> ，注意不是 <code>d.deptno</code> ，要忽略掉右表的NULL值。<p></p><ol start="2" type="1"><li><p>查询每个部门的名称和部门的人数？如果没有部门的员工，部门名 称用NULL代替。(指陈浩，没有部门号，也就没有部门)</p><blockquote><p>首先，上一题的左外连接就是把陈浩这条排除掉了因为右表的陈浩deptno是NULL。那么又想到了右外连接把他算进来。但是这时，又把本来的deptno=40的部门给排除掉了因为没有人是这个部门。所以这时，需要把两个结果并起来。使用关键字<strong>UNION</strong></p></blockquote><p><strong>UNION关键字可以将多个查询语句的结果集进行合并</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">(<br>	SELECT d.deptno, d.dname, COUNT(e.deptno)<br>	FROM t_dept d LEFT JOIN t_emp e <br>	ON d.deptno&#x3D;e.deptno<br>	GROUP BY d.deptno<br>) UNION<br>(<br>	SELECT d.deptno, d.dname, COUNT(*)<br>	FROM t_dept d RIGHT JOIN t_emp e <br>	ON d.deptno&#x3D;e.deptno<br>	GROUP BY d.deptno<br>);	<br></code></pre></td></tr></table></figure><blockquote><p>左连接中要改成 <code>e.deptno</code> ，而不是 <code>d.deptno</code> ，因为要忽略掉右表的NULL值， <code>COUNT(*)</code> 会把NULL值也算成一。</p><p>而右连接中要改成 <code>COUNT(*)</code> ，而不是 <code>e.deptno</code> 或 <code>d.deptno</code> 。因为以右表看左表的话，陈浩是空部门但是也是有一个人。写成 <code>d.deptno</code> 的话陈浩的deptno=NULL直接就算成0了。</p></blockquote></li><li><p>查询每名员工的编号、姓名、部门、月薪、工资等级、工龄、上司编号、上司姓名、上司部门？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select e.empno, e.ename, d.dname, <br>e.sal+IFNULL(comm, 0) as &#39;月薪&#39;, s.grade,  <br>FLOOR(DATEDIFF(NOW(),e.hiredate)&#x2F;365) as &#39;工龄&#39;,<br>t.empno as mgr_no, t.ename as mgr_name, t.dname as mgr_dname<br>from t_emp e <br>left join t_dept d ON e.deptno&#x3D;d.deptno<br>left join t_salgrade s ON e.sal between s.losal and hisal<br>left join <br>(select e1.empno, e1.ename, d1.dname <br>from t_emp e1 join t_dept d1<br>on e1.deptno&#x3D;d1.deptno<br>) t<br>on e.mgr&#x3D;t.empno ;<br></code></pre></td></tr></table></figure></li></ol><p>外连接注意事项： 内连接只保留符合条件的记录，所以查询条件写在 ON 子句和 WHERE 子句中的效果是相同的。但是外连接里，条件写在 WHERE 子句里，不合符条件的记录是会被过滤掉的，而如果写 ON ，即使不符合条件也会被左外连接保留下来。</p><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210209165346348.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:75%"></center><center><img src="https://gitee.com/stuxiaozhang/blogimage/raw/master/img/编程语言/Python/image-20210209165408866.png" srcset="/img/loading.gif" lazyload alt="pokeman-parameters" style="width:75%"></center><h2 id="子查询">子查询</h2><p>子查询是一种查询中嵌套查询的语句，可以写在三个地方：WHERE子句、FROM子句、SELECT子句。</p><p>查询语句执行的时候要多次的依赖于子查询的结果，这类子查询被称作相关子查询：WHERE 子查询和 SELECT 子查询都属于相关子查询 。因为相关子查询要反复多次执行，所以应该避免使用。所以只有FROM子句子查询是最可取的。</p><p>栗： 查询底薪超过公司平均底薪的员工的信息</p><ul><li><p>WHERE 子查询：最简单，最容易理解，但是却是效率很低的子查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT empno, ename, sal<br>FROM t_emp<br>WHERE sal&gt;&#x3D;(SELECT AVG(sal) FROM t_emp)<br></code></pre></td></tr></table></figure></li><li><p>FROM子查询：只会执行一次，所以查询效率很高</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename, e.sal, t.avg<br>FROM t_emp e<br>JOIN(<br>  SELECT deptno, AVG(sal) as avg<br>  FROM t_emp GROUP BY deptno) t<br>ON e.deptno&#x3D;t.deptno AND e.sal&gt;&#x3D;t.avg<br></code></pre></td></tr></table></figure></li><li><p>SELECT子查询：每输出一条记录的时候都要执行一次，查询效率很低</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.empno, e.ename<br>  (SELECT dname FROM t_dept WHERE deptno&#x3D;e.deptno)<br>FROM t_emp e;<br></code></pre></td></tr></table></figure></li></ul></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a> <a class="hover-with-bg" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/SQL/">SQL</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/SQL/">SQL</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处来源：<a href="https://stuxiaozhang.github.io/">小张的宇宙空间站</a></p><div class="post-prevnext"><article class="post-prev col-6"><a href="/2021/02/06/SQL%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80DQL/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">SQL的数据查询语言DQL</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2021/02/05/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/"><span class="hidden-mobile">数据库表的相关操作</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",function(){Fluid.utils.createScript("https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js",function(){var e=Object.assign({appId:"81O1jSOqY3veRxOg71BDYfri-gzGzoHsz",appKey:"CgnvRL262D07ied40NiXm2VL",placeholder:"快来评论鸭~",path:"window.location.pathname",avatar:"retro",meta:["nick","mail","link"],pageSize:10,lang:"zh-CN",highlight:!0,recordIP:!0,serverURLs:"",emojiCDN:"https://cdn.bootcdn.net/ajax/libs/emojione/4.5.0/lib/js/emojione.min.js",emojiMaps:null,enableQQ:!0,requiredFields:["nick"]},{el:"#valine",path:window.location.pathname});new Valine(e)})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://stuxiaozhang.github.io" target="_blank" rel="nofollow noopener"><span>小张同学的宇宙空间站</span></a> 已经运转了<span id="timeDate">载入天数...</span><script src="/js/duration.js"></script></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script src="/js/local-search.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},options:{renderActions:{findScript:[10,a=>{document.querySelectorAll('script[type^="math/tex"]').forEach(e=>{var t=!!e.type.match(/; *mode=display/);const n=new a.options.MathItem(e.textContent,a.inputJax[0],t);t=document.createTextNode("");e.parentNode.replaceChild(t,e),n.start={node:t,delim:"",n:0},n.end={node:t,delim:"",n:0},a.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}}</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.4/es5/tex-svg.js"></script><script src="/js/boot.js"></script></body></html>